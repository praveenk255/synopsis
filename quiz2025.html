<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Multi Quiz App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide/dist/umd/lucide.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
        }
        /* Custom styles for the progress ring SVG */
        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        /* Style for the answer buttons */
        .option-btn.selected {
            background-color: #4a5568;
            border: 2px solid #6366f1;
        }
        /* Style for the message box and modals */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
        }
        /* Sticky header */
        #quizStatusBar.sticky-top {
            position: sticky;
            top: 0;
            z-index: 20;
        }
        /* Style for the bar chart */
        .bar {
            background-color: #4f46e5;
            transition: height 0.5s ease-in-out;
            min-height: 5px;
            border-radius: 4px;
        }
        /* Loading spinner */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #6366f1;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 60;
            display: none; /* Hidden by default */
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">

    <div id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <div id="navbar" class="flex justify-between items-center bg-gray-800 p-4 shadow-lg sticky top-0 z-10">
        <h1 class="text-xl font-bold flex items-center gap-2">
            <i data-lucide="layers" class="h-6 w-6 text-indigo-400"></i> Multi Quiz App
        </h1>
        <div id="navbar-buttons" class="flex gap-2">
            <button id="mixQuizBtn" class="bg-gray-600 text-sm px-4 py-2 rounded-full hover:bg-gray-700 transition-colors duration-200 flex items-center gap-1">
                <i data-lucide="shuffle" class="h-4 w-4"></i> Mix Quiz
            </button>
            <button id="insightsBtn" class="bg-indigo-600 text-sm px-4 py-2 rounded-full hover:bg-indigo-700 transition-colors duration-200 flex items-center gap-1">
                <i data-lucide="bar-chart-3" class="h-4 w-4"></i> Insights
            </button>
            <button id="quizBtn" class="hidden bg-indigo-600 text-sm px-4 py-2 rounded-full hover:bg-indigo-700 transition-colors duration-200 flex items-center gap-1">
                <i data-lucide="layout-dashboard" class="h-4 w-4"></i> Quiz
            </button>
        </div>
    </div>
    
    <div id="mainSection" class="p-4 grid grid-cols-2 gap-4 flex-grow">
    </div>

    <div id="insightsSection" class="hidden p-4 space-y-6 flex-grow">
        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
            <i data-lucide="activity" class="h-6 w-6 text-indigo-400"></i> Dashboard
        </h2>

        <div class="bg-gray-800 p-6 rounded-2xl shadow-xl flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0 md:space-x-8">
            <div class="relative w-40 h-40 flex-shrink-0">
                <svg class="w-full h-full" viewBox="0 0 100 100">
                    <circle 
                        class="text-gray-700"
                        stroke-width="10"
                        stroke="currentColor"
                        fill="transparent"
                        r="45"
                        cx="50"
                        cy="50"
                    />
                    <circle
                        id="progressCircle"
                        class="progress-ring__circle text-indigo-600"
                        stroke-width="10"
                        stroke-linecap="round"
                        stroke="currentColor"
                        fill="transparent"
                        r="45"
                        cx="50"
                        cy="50"
                    />
                </svg>
                <div class="absolute inset-0 flex flex-col items-center justify-center">
                    <span id="overallAccuracy" class="text-3xl font-bold text-indigo-400">0%</span>
                    <span class="text-sm text-gray-400">Overall Accuracy</span>
                </div>
            </div>
            
            <div id="dashboardStats" class="grid grid-cols-1 md:grid-cols-3 gap-4 w-full md:w-auto">
            </div>
        </div>

        <div class="bg-gray-800 p-6 rounded-2xl shadow-xl space-y-4">
            <h3 class="text-xl font-bold flex items-center gap-2">
                <i data-lucide="line-chart" class="h-5 w-5 text-indigo-400"></i> Quiz Accuracy (Per Quiz)
            </h3>
            <div id="quizBarChart" class="flex items-end justify-around h-40 space-x-2 w-full text-xs">
            </div>
            <p id="chartMessage" class="text-center text-gray-400 hidden">Start a quiz to see your progress!</p>
        </div>

        <div class="bg-gray-800 p-4 rounded-xl shadow-lg">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2 text-red-400">
                <i data-lucide="alert-triangle" class="h-5 w-5"></i> Past Mistakes
            </h2>
            <select id="mistakesQuizSelector" class="w-full mb-4 px-3 py-2 rounded-lg text-black bg-gray-200">
                <option value="">-- Select Quiz --</option>
            </select>
            <div id="mistakesContainer" class="space-y-4"></div>
        </div>

        <button id="startNewQuizBtn" class="bg-indigo-600 px-6 py-2 rounded-full font-semibold hover:bg-indigo-700 transition-colors duration-200 w-full text-center">
            Start a new quiz
        </button>
    </div>

    <div id="quizSection" class="hidden p-6 space-y-6 flex-grow flex flex-col items-center justify-center">
        <div id="quizStatusBar" class="hidden bg-gray-800 bg-opacity-50 p-2 rounded-xl shadow-lg w-full max-w-4xl mb-6 flex items-center text-sm sticky-top">
            <button id="backBtn" class="bg-gray-600 p-2 rounded-full hover:bg-gray-700 transition-colors duration-200">
                <i data-lucide="chevron-left" class="h-5 w-5 text-white"></i>
            </button>
            <div class="flex-grow flex justify-around items-center">
                <p>Qs: <span id="qsAttempted" class="font-bold text-indigo-400">0</span></p>
                <p>Correct: <span id="qsCorrect" class="font-bold text-green-400">0</span></p>
                <p>Incorrect: <span id="qsIncorrect" class="font-bold text-red-400">0</span></p>
                <p>Accuracy: <span id="qsAccuracy" class="font-bold text-yellow-400">0%</span></p>
            </div>
        </div>

        <div id="questionsContainer" class="space-y-8 w-full max-w-2xl">
        </div>

        <button id="submitQuizBtn" class="mt-6 bg-indigo-600 px-8 py-3 rounded-full font-semibold hover:bg-indigo-700 transition-colors duration-200">
            Submit Quiz
        </button>
    </div>

    <div id="mixQuizModal" class="message-box hidden bg-gray-800 p-6 rounded-2xl shadow-xl w-full max-w-lg">
        <h3 class="text-2xl font-bold mb-4 text-center">Select Quizzes to Mix</h3>
        <div id="quizList" class="max-h-80 overflow-y-auto mb-4 p-2 rounded-md bg-gray-700 space-y-2">
        </div>
        <div class="flex justify-center gap-4 mt-6">
            <button id="startMixQuizBtn" class="bg-indigo-600 px-6 py-2 rounded-full font-semibold hover:bg-indigo-700 transition-colors duration-200">Start Mix Quiz (100 Qs)</button>
            <button id="cancelMixQuizBtn" class="bg-gray-600 px-6 py-2 rounded-full font-semibold hover:bg-gray-700 transition-colors duration-200">Cancel</button>
        </div>
    </div>

    <div id="messageBox" class="message-box hidden bg-gray-800 p-6 rounded-xl shadow-xl text-center w-80">
        <p id="messageText" class="text-white text-lg font-semibold mb-4"></p>
        <button id="messageBoxCloseBtn" class="bg-indigo-600 px-6 py-2 rounded-full font-semibold hover:bg-indigo-700 transition-colors duration-200">
            OK
        </button>
    </div>

    <div id="reattemptModal" class="message-box hidden bg-gray-800 p-6 rounded-xl shadow-xl text-center w-96">
        <h3 class="text-2xl font-bold mb-4">Reattempt Quiz</h3>
        <p class="text-white mb-4">Are you sure you want to reattempt the wrong/unattempted questions?</p>
        <div class="flex justify-center gap-4 mt-6">
            <button id="confirmReattemptBtn" class="bg-indigo-600 px-6 py-2 rounded-full font-semibold hover:bg-indigo-700 transition-colors duration-200">Yes</button>
            <button id="cancelReattemptBtn" class="bg-gray-600 px-6 py-2 rounded-full font-semibold hover:bg-gray-700 transition-colors duration-200">Cancel</button>
        </div>
    </div>

    <div id="quizSummaryModal" class="message-box hidden bg-gray-800 p-6 rounded-2xl shadow-2xl text-center w-full max-w-lg">
        <button id="closeSummaryModalBtn" class="absolute top-2 right-2 text-gray-400 hover:text-gray-200">
            <i data-lucide="x" class="h-6 w-6"></i>
        </button>
        <h3 class="text-2xl font-bold mb-4">Quiz Summary</h3>
        <div class="relative w-32 h-32 mx-auto mb-4">
            <svg class="w-full h-full" viewBox="0 0 100 100">
                <circle class="text-gray-700" stroke-width="10" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" />
                <circle id="summaryProgressCircle" class="progress-ring__circle text-indigo-600" stroke-width="10" stroke-linecap="round" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" />
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-center">
                <span id="summaryAccuracy" class="text-3xl font-bold text-indigo-400">0%</span>
            </div>
        </div>
        <div class="space-y-2 text-left mb-6">
            <p class="text-xl font-bold">Score: <span id="summaryScore" class="font-bold text-indigo-400">0/0</span></p>
            <p class="text-xl font-bold">Correct: <span id="summaryCorrect" class="font-bold text-green-400">0</span></p>
            <p class="text-xl font-bold">Incorrect: <span class="font-bold text-red-400">0</span></p>
            <p class="text-xl font-bold">Unattempted: <span class="font-bold text-yellow-400">0</span></p>
        </div>
        <div class="flex flex-col md:flex-row justify-center gap-4 mt-6">
            <button id="resetQuizBtn" class="bg-gray-600 px-6 py-2 rounded-full font-semibold hover:bg-gray-700 transition-colors duration-200">Reset Quiz</button>
            <button id="reattemptWrongBtn" class="bg-indigo-600 px-6 py-2 rounded-full font-semibold hover:bg-indigo-700 transition-colors duration-200">Reattempt Wrong/Unattempted</button>
            <button id="quitQuizBtn" class="bg-red-600 px-6 py-2 rounded-full font-semibold hover:bg-red-700 transition-colors duration-200">Quit Quiz</button>
        </div>
    </div>

    <script>
        // Data for quizzes
        const quizzes = [
            { "name": "Basic 1", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkl3zFBB8s5jFoh3mNbRUbETM6k0FPkBwRmu9sRO-SSTFb5O-HaxPNACCjqOLgXEdzpVJxRYetJ4aO/pub?output=csv" },
            { "name": "Basic 2", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSIpr6CpRW3F9kae8F3_cqqiXOtEL6CqCJlgsiJ79_l348bEsa2UWI93i4_chElLeG4JDNGSudflxf9/pub?output=csv" },
            { "name": "Basic 3", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQXg2KZDq8TtDq8xjVMNaveQXkhBrTIuxC-39EK1htO68FMKfEeLUfhqCNsacxSm6Vk5rg7eusQP_au/pub?output=csv" },
            { "name": "Basic 4", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTepTt61Dhntqokek0QH1fQK0Oo3lOI9qHbwHNGIbe2hk8vU3XHH2OiN1HyvoEwpY81Vi0ISOrqzYae/pub?output=csv" },
            { "name": "Basic 5", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRSnPYhv-vMmKL77c5XoirZGaqMjVyEppgq9Wp9S6GfDUvP1IiZRY2kZ6K2pT5LDPMXto1D1R3f2-Vu/pub?output=csv" },
            { "name": "Basic 6", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSJUr0Br78XjprIIUkZhN94udUK9YhODYRLmLiKSkhz6ifqhh1PIshqv_ZaM6kpDumwy6V_oCmjNt9E/pub?output=csv" },
            { "name": "Basic 7", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRejjJTEmWGWXlrnOoUDSkAMm7P9GXRMd3wEpl2U3zk4Aua3NJLVhnFRAh8quK3-8FV-KbDr_RDz5-4/pub?output=csv" },
            { "name": "Basic 8", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQAEQfNB9GxnTAXPPhYQd4aN3Mjizk3WauJ-IoUGlSCG6MmQdZmtB896hFOPdDxWgkgJf739RWSCS0_/pub?output=csv" },
            { "name": "Basic 9", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRj1KcGeC1ZYQsmzEp3zOeDv4MgSAqSwkp7vjQh0b-R1o58gfScF25zz4K9UByc5PhYA4qZDSCA7OKw/pub?output=csv" },
            { "name": "Basic 10", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSKKmIAXa0qs-dFO4njh3DmZGu5JoDTpfaZWOWXNtO5_DFz42YSATMwHCQ7v56MRJLIjp9QPZMOgM6X/pub?output=csv" },
            { "name": "Basic 11", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTZEpBXKF8Rn67md2PhNTH4w-a0EG4ytYOuGdsjYSzSugSv3i3Q9SszT1OXeCYAt7HR4e2nAsO3bWp8/pub?output=csv" },
            { "name": "Terminologies", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vStq66g33WI6VxWrVx-l_eheqjxuOW2dYZTGDwQcxC4GrZpgUflUdUwuNqSiNTnyU4g8DklR2Cy7rOi/pub?output=csv" },
            { "name": "Abbreviations", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZDZq92XW_asvWanWZz0qqsB32f8XfJhxOR62bcfZDcGbvtX0LUbgRART2aiFdq59gIkT2A8Yu3zIS/pub?output=csv" },
            { "name": "Incidents", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vT8WHfGycBq4rjzcjbtNrQUV6H4oU-YdfYO9Ci8V_xsEuguPQXYXODCau-If4U_82BqLrliYKErXGkV/pub?output=csv" },
            { "name": "Conventions", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTXOLrIsbQ58dWOI6RDPQiJN27OCOvU_oeXFuH4wAHWHjo_oHQ-YKvepdJdZrABK6dlWA_tfT6l5CNN/pub?output=csv" },
            { "name": "Rules1937andAct1934", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2pcMHMF2YXQ91J9XVEtX7jOiZxf28oQ3jA7RqOc6qTsrZsJsYLwhkVW1X1wKWoB5MygkrdWpfXVmA/pub?output=csv" },
            { "name": "Circulars", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQaql9xRL5KFtTQmEG9r0UfmsnZne1zqMpLKn8quvJXFs-1De9vcwo741Z-be4trXcOHp_NaP5YVGJ2/pub?output=csv" },
            { "name": "Explosives", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTPwf4tOTuIDTAJVDg6w7OL5T_y4RfWxdCy687Wqd0ZnsqTMmVcYqV-D6hLCmpQTiKBPKrNAyjCjQLR/pub?output=csv" },
            { "name": "Module of 30 Q", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQHAZU2pIQg0EM5wkypV6PiwbagA2-LweljvkfjW5SRhwHdR4eVYkIB19-d-rv3WXF3S9KpSyOykYv3/pub?output=csv" },
            { "name": "Mod 1", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTCpUs74l9QITASGdd7wO9mIW5ifcYvA8OV-2UNTW2N0_vI3tWGpGjbj6TXQhNdbi9yccnQnI2-2yEK/pub?output=csv" },
            { "name": "Mod 2", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRstO_Vbz7RSytJgBKaTVNHi4Dp8bXsKR58Z3vpWJY_weK6wFqw88YqmLOFwRCbodAQXEOYtt_fkqjE/pub?output=csv" },
            { "name": "Mod 3", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrJ0UfD-CvjdntSEm7TKHssI4Ui2Rylq-8R6E76iOgDm8M9AQgDhNo5EGsPmOzod7-HV7nW_4_e8gq/pub?output=csv" },
            { "name": "Mod 4", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTOAo2lp97mPkU63oD5nNxPbka4g2cJzTYcvN6bG6P535wrGs3UbXu5bbfeSdh0A5vny5Xq-qVtLot_/pub?output=csv" },
            { "name": "Mod 5", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vT6EbXzABp32AS4Ku7wbadAvjRPNa-Vwr_D1PrSZvVSDTQjW4IISoyKI5zkNiQggxcL5XDN6mOqJJ1k/pub?output=csv" },
            { "name": "Mod 6", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQfaFlkYOGovauithx2HGcg0R1vyK0hJsXu86Cjz2KMKcN0-GjGvUAb9ZVrBDaTIONmvGiIUnx_sP8a/pub?output=csv" },
            { "name": "Mod 7", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkLEy6tGtzBHABNmdmc9-ZFBjhNObkVlNqZWXnG1SyPq19bYFJQI5gdJlgfppZyaV3uHlEKHpFqDG4/pub?output=csv" },
            { "name": "Contingency and Rest", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRuTWEVJRYr-NsIrjKxdPsTaUblf7ZoLUL7CmGjEj9cvqaXopbzoszaOwW-Envs0vVjB563155wwREP/pub?output=csv" },
            { "name": "Screening And Profiling Plus Rest", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRTsL8D-BXxylajwusK-O6afuasruhr04wmy-RpqDdVTDKYFRRShi9UR7GYk0pk2Z2yC_IfFDCUYwMF/pub?output=csv" },
            { "name": "MiscGeminiQuestions", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRJo0G6_xDZUSnjhzYlli9lYlEgRXyeJ0uJTdORBWlzSDPBou2vfIKzVnRhFCk7FQttF99TjdtESGyk/pub?output=csv" },
            { "name": "MiscGeminiQuestions3", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRc2vqEgsOS08H2kzmD_hzcUUzLtvd8OGk4LOFrQfGt9i0XN3oy2QhJDB5ASbEGIbOgDIk3yljqMGhU/pub?output=csv" },
            { "name": "Rules2023", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTcla7Z19956dwDbDC5DBaAUEjkZ86AnZI5d8hh75bBYBZi8Wywpn4Sz4O6OBCyk7rDWxdr8eyqi0_R/pub?output=csv" },
            { "name": "ContingencyNew", "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vR-Wqco1ZH8FLR8iEjWH7PrWFQ-LQ2kLEzjZdDNMthVDJsqSJ8yuivLXX8qp8EetzqTElSuB1k7X5z_/pub?output=csv" }
        ];
        // Get DOM elements
        const navbar = document.getElementById("navbar");
        const mainSection = document.getElementById("mainSection");
        const insightsSection = document.getElementById("insightsSection");
        const insightsBtn = document.getElementById("insightsBtn");
        const quizBtn = document.getElementById("quizBtn");
        const mixQuizBtn = document.getElementById("mixQuizBtn");
        const backBtn = document.getElementById("backBtn");
        const dashboardStats = document.getElementById("dashboardStats");
        const overallAccuracySpan = document.getElementById("overallAccuracy");
        const progressCircle = document.getElementById("progressCircle");
        const mistakesQuizSelector = document.getElementById("mistakesQuizSelector");
        const mistakesContainer = document.getElementById("mistakesContainer");
        const quizBarChart = document.getElementById("quizBarChart");
        const chartMessage = document.getElementById("chartMessage");
        const quizSection = document.getElementById("quizSection");
        const questionsContainer = document.getElementById("questionsContainer");
        const quizStatusBar = document.getElementById("quizStatusBar");
        const qsAttemptedEl = document.getElementById("qsAttempted");
        const qsCorrectEl = document.getElementById("qsCorrect");
        const qsIncorrectEl = document.getElementById("qsIncorrect");
        const qsAccuracyEl = document.getElementById("qsAccuracy");
        const mixQuizModal = document.getElementById("mixQuizModal");
        const quizList = document.getElementById("quizList");
        const startMixQuizBtn = document.getElementById("startMixQuizBtn");
        const cancelMixQuizBtn = document.getElementById("cancelMixQuizBtn");
        const messageBox = document.getElementById("messageBox");
        const messageText = document.getElementById("messageText");
        const messageBoxCloseBtn = document.getElementById("messageBoxCloseBtn");
        const startNewQuizBtn = document.getElementById("startNewQuizBtn");
        const submitQuizBtn = document.getElementById("submitQuizBtn");
        const quizSummaryModal = document.getElementById("quizSummaryModal");
        const closeSummaryModalBtn = document.getElementById("closeSummaryModalBtn");
        const summaryScoreEl = document.getElementById("summaryScore");
        const summaryCorrectEl = document.getElementById("summaryCorrect");
        const summaryIncorrectEl = document.getElementById("summaryIncorrect");
        const summaryUnattemptedEl = document.getElementById("summaryUnattempted");
        const summaryAccuracyEl = document.getElementById("summaryAccuracy");
        const summaryProgressCircle = document.getElementById("summaryProgressCircle");
        const resetQuizBtn = document.getElementById("resetQuizBtn");
        const reattemptWrongBtn = document.getElementById("reattemptWrongBtn");
        const reattemptModal = document.getElementById("reattemptModal");
        const confirmReattemptBtn = document.getElementById("confirmReattemptBtn");
        const cancelReattemptBtn = document.getElementById("cancelReattemptBtn");
        const quitQuizBtnSummary = document.getElementById("quitQuizBtn");
        const loadingOverlay = document.getElementById("loadingOverlay");

        // State variables for the current quiz
        let currentQuizName = '';
        let quizQuestions = [];
        let score = 0;
        let mistakes = [];
        let attemptedCount = 0;
        let totalQuestions = 0;
        let allQuizzesData = {}; // Stores all fetched quiz data

        // Utility function to shuffle an array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            await fetchAllQuizData();
            renderQuizCards();
            populateMistakesSelector();
            lucide.createIcons();
        });

        async function fetchAllQuizData() {
            loadingOverlay.style.display = 'flex';
            const fetchPromises = quizzes.map(async q => {
                const data = await fetchQuizData(q.url);
                return { name: q.name, data };
            });

            const results = await Promise.all(fetchPromises);
            results.forEach(result => {
                if (result.data) {
                    allQuizzesData[result.name] = result.data;
                }
            });
            loadingOverlay.style.display = 'none';
        }

        // Function to show custom message box
        function showMessageBox(message) {
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
        }

        // Function to hide custom message box
        messageBoxCloseBtn.onclick = () => {
            messageBox.classList.add('hidden');
        };

        function renderQuizCards() {
            mainSection.innerHTML = "";
            const allQuizzes = [...quizzes, { name: "Mixed Quiz", url: "" }];

            allQuizzes.forEach(q => {
                let total, attempted, correct, progress;

                if (q.name === "Mixed Quiz") {
                    const mixedStats = JSON.parse(localStorage.getItem("Mixed Quiz" + "_stats"));
                    total = mixedStats ? mixedStats.total : 0;
                    attempted = mixedStats ? mixedStats.attempted : 0;
                    correct = mixedStats ? mixedStats.correct : 0;
                    progress = JSON.parse(localStorage.getItem("Mixed Quiz" + "_progress"));
                } else {
                    const data = allQuizzesData[q.name];
                    const progressData = JSON.parse(localStorage.getItem(q.name + "_progress"));

                    if (data) {
                         const stats = { attempted: progressData ? progressData.attemptedCount : 0, correct: progressData ? progressData.score : 0, total: data.length };
                         localStorage.setItem(q.name + "_stats", JSON.stringify(stats));
                    }
                    const stats = JSON.parse(localStorage.getItem(q.name + "_stats"));
                    total = stats ? stats.total : 0;
                    attempted = stats ? stats.attempted : 0;
                    correct = stats ? stats.correct : 0;
                    progress = progressData;
                }

                const accuracy = attempted ? Math.round((correct / attempted) * 100) : 0;
                
                const card = document.createElement("div");
                card.className = "bg-gray-800 p-4 rounded-xl shadow-lg flex flex-col justify-between transform transition-transform hover:scale-105";
                let buttonHtml;
                let buttonAction;
                
                if (progress && progress.attemptedCount > 0 && progress.attemptedCount < progress.totalQuestions) {
                    buttonHtml = `<button class="resumeBtn flex-1 bg-indigo-600 py-1 rounded-full hover:bg-indigo-700 transition-colors duration-200">Resume</button>`;
                    buttonAction = () => startQuiz(q.name);
                } else if (q.name === "Mixed Quiz") {
                    buttonHtml = `<span class="text-xs text-gray-400">Use "Mix Quiz" button above</span>`;
                    buttonAction = () => {};
                } else {
                    buttonHtml = `<button class="startBtn flex-1 bg-indigo-600 py-1 rounded-full hover:bg-indigo-700 transition-colors duration-200">Start</button>`;
                    buttonAction = () => startQuiz(q.name, true);
                }

                card.innerHTML = `
                    <h2 class="text-sm md:text-md font-bold mb-2 truncate"><i data-lucide="file-text" class="inline-block mr-1 h-4 w-4 text-purple-400"></i> ${q.name}</h2>
                    <div class="text-xs text-gray-400 mb-4">
                        <p>Progress: <span class="font-semibold">${attempted}/${total}</span></p>
                        <p>Accuracy: <span class="font-semibold">${accuracy}%</span></p>
                    </div>
                    <div class="flex gap-2 mt-auto text-sm">
                        ${buttonHtml}
                    </div>
                `;
                mainSection.appendChild(card);
                if (q.name !== "Mixed Quiz") {
                    card.querySelector("button").onclick = buttonAction;
                }
            });
            lucide.createIcons();
        }

        async function fetchQuizData(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvText = await response.text();
                return parseCSV(csvText);
            } catch (error) {
                showMessageBox(`Failed to load quiz data: ${error.message}`);
                return null;
            }
        }

        function parseCSV(text) {
            const lines = text.split('\n').filter(line => line.trim() !== '');
            if (lines.length <= 1) return [];
            
            const questions = [];
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                const fields = [];
                let inQuote = false;
                let currentField = '';
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    if (char === '"') {
                        inQuote = !inQuote;
                    } else if (char === ',' && !inQuote) {
                        fields.push(currentField.trim());
                        currentField = '';
                    } else {
                        currentField += char;
                    }
                }
                fields.push(currentField.trim());

                if (fields.length >= 7) { 
                    questions.push({
                        question: fields[1], 
                        options: [fields[2], fields[3], fields[4], fields[5]].filter(o => o !== ''),
                        answer: fields[6],
                        userAnswer: null, // Add a property to store the user's answer
                        isCorrect: null   // Add a property to store if the answer was correct
                    });
                }
            }
            return questions;
        }

        async function startQuiz(name, isNewStart = false) {
            currentQuizName = name;
            
            const savedProgress = JSON.parse(localStorage.getItem(currentQuizName + "_progress"));
            let lastQuestionIndex = 0; // Default to first question
            
            if (isNewStart || !savedProgress) {
                const data = allQuizzesData[name];

                if (!data || data.length === 0) {
                    showMessageBox("No questions found for this quiz.");
                    return;
                }

                // Randomize the order of questions
                shuffleArray(data);
                quizQuestions = data;
                totalQuestions = quizQuestions.length;
                score = 0;
                mistakes = [];
                attemptedCount = 0;
                localStorage.removeItem(currentQuizName + "_progress");
            } else {
                quizQuestions = savedProgress.quizQuestions;
                totalQuestions = savedProgress.totalQuestions;
                score = savedProgress.score;
                mistakes = savedProgress.mistakes;
                attemptedCount = savedProgress.attemptedCount;
                lastQuestionIndex = attemptedCount; // Set scroll position to the last attempted question
            }
            
            mainSection.classList.add('hidden');
            insightsSection.classList.add('hidden');
            navbar.classList.add('hidden');
            quizSection.classList.remove('hidden');
            quizStatusBar.classList.remove('hidden');
            
            renderQuestions();
            updateStatusBar();
            
            // Auto-scroll to the last attempted question on resume
            if (!isNewStart && lastQuestionIndex > 0) {
                setTimeout(() => {
                    const lastQuestionCard = document.getElementById(`question-card-${lastQuestionIndex - 1}`);
                    if (lastQuestionCard) {
                        lastQuestionCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 100);
            } else {
                window.scrollTo(0, 0); // Scroll to top for new quiz
            }
        }

        function saveProgress() {
            const progress = {
                quizQuestions: quizQuestions,
                score: score,
                mistakes: mistakes,
                attemptedCount: attemptedCount,
                totalQuestions: totalQuestions
            };
            localStorage.setItem(currentQuizName + "_progress", JSON.stringify(progress));
        }

        function updateStatusBar() {
            qsAttemptedEl.textContent = attemptedCount;
            qsCorrectEl.textContent = score;
            qsIncorrectEl.textContent = mistakes.length;
            const accuracy = attemptedCount ? Math.round((score / attemptedCount) * 100) : 0;
            qsAccuracyEl.textContent = `${accuracy}%`;
        }

        function renderQuestions() {
            questionsContainer.innerHTML = '';
            quizQuestions.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.id = `question-card-${index}`;
                questionCard.className = "question-card bg-gray-800 p-6 rounded-2xl shadow-xl w-full space-y-4";

                const questionNumber = document.createElement('div');
                questionNumber.className = "text-sm text-gray-400 mb-2";
                questionNumber.textContent = `Question ${index + 1} of ${quizQuestions.length}`;

                const questionText = document.createElement('div');
                questionText.className = "text-xl font-semibold mb-4";
                questionText.textContent = q.question;
                
                const optionsContainer = document.createElement('div');
                optionsContainer.className = "grid grid-cols-1 md:grid-cols-2 gap-4";

                q.options.forEach(option => {
                    const button = document.createElement('button');
                    button.className = "option-btn bg-gray-700 p-4 rounded-xl text-left w-full hover:bg-gray-600 transition-colors duration-200";
                    button.textContent = option;
                    button.onclick = () => checkAnswer(index, button, option);
                    optionsContainer.appendChild(button);
                });

                const feedback = document.createElement('div');
                feedback.id = `feedback-${index}`;
                feedback.className = "mt-4 text-center hidden text-lg font-bold";

                questionCard.appendChild(questionNumber);
                questionCard.appendChild(questionText);
                questionCard.appendChild(optionsContainer);
                questionCard.appendChild(feedback);
                questionsContainer.appendChild(questionCard);

                // If a question was previously answered, re-render its state
                if (q.userAnswer) {
                    const selectedBtn = Array.from(optionsContainer.querySelectorAll('.option-btn')).find(btn => btn.textContent === q.userAnswer);
                    if (selectedBtn) {
                        checkAnswer(index, selectedBtn, q.userAnswer, true);
                    }
                }
            });
        }

        function checkAnswer(questionIndex, selectedBtn, userAnswer, isResume = false) {
            const questionCard = document.getElementById(`question-card-${questionIndex}`);
            const optionButtons = questionCard.querySelectorAll('.option-btn');
            const feedbackEl = document.getElementById(`feedback-${questionIndex}`);

            // If question is already answered, do nothing
            if (questionCard.classList.contains('answered') && !isResume) {
                return;
            }

            const currentQ = quizQuestions[questionIndex];
            
            let actualCorrectAnswer;
            if (!isNaN(currentQ.answer) && parseInt(currentQ.answer) >= 1 && parseInt(currentQ.answer) <= 4) {
                actualCorrectAnswer = currentQ.options[parseInt(currentQ.answer) - 1];
            } else {
                actualCorrectAnswer = currentQ.answer;
            }
            
            // Mark question as answered
            currentQ.userAnswer = userAnswer;
            currentQ.correctAnswer = actualCorrectAnswer;
            questionCard.classList.add('answered');

            const isCorrect = (currentQ.userAnswer === actualCorrectAnswer);
            currentQ.isCorrect = isCorrect;
            
            // Re-calculate stats based on the full, original question set
            const fullStats = JSON.parse(localStorage.getItem(currentQuizName + "_stats")) || {
                correct: 0,
                incorrect: 0,
                total: totalQuestions,
                attempted: 0
            };

            // If we are in reattempt mode, update original stats
            if (quizQuestions.length < totalQuestions) {
                // Find the original question in the full list and update its state
                const originalQuizQuestions = JSON.parse(localStorage.getItem(currentQuizName + "_progress")).quizQuestions;
                const originalQ = originalQuizQuestions.find(q => q.question === currentQ.question);
                if (originalQ) {
                    originalQ.userAnswer = userAnswer;
                    originalQ.isCorrect = isCorrect;
                }
                
                // Recalculate full stats
                fullStats.correct = originalQuizQuestions.filter(q => q.isCorrect).length;
                fullStats.incorrect = originalQuizQuestions.filter(q => q.userAnswer && !q.isCorrect).length;
                fullStats.unattempted = originalQuizQuestions.filter(q => q.userAnswer === null).length;
                fullStats.attempted = originalQuizQuestions.filter(q => q.userAnswer).length;

                // Save updated full progress
                localStorage.setItem(currentQuizName + "_progress", JSON.stringify({
                    quizQuestions: originalQuizQuestions,
                    score: fullStats.correct,
                    mistakes: originalQuizQuestions.filter(q => q.userAnswer && !q.isCorrect).map(q => ({ question: q.question, userAnswer: q.userAnswer, correctAnswer: q.correctAnswer })),
                    attemptedCount: fullStats.attempted,
                    totalQuestions: totalQuestions
                }));

                // Update mistakes
                mistakes = originalQuizQuestions.filter(q => q.userAnswer && !q.isCorrect).map(q => ({
                    question: q.question,
                    userAnswer: q.userAnswer,
                    correctAnswer: q.correctAnswer
                }));

            } else {
                // If not in reattempt mode, update current stats
                attemptedCount = quizQuestions.filter(q => q.userAnswer).length;
                score = quizQuestions.filter(q => q.isCorrect).length;
                mistakes = quizQuestions.filter(q => q.userAnswer && !q.isCorrect).map(q => ({
                    question: q.question,
                    userAnswer: q.userAnswer,
                    correctAnswer: q.correctAnswer
                }));
            }
            
            // Visually update UI
            optionButtons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === actualCorrectAnswer) {
                    btn.classList.add('bg-green-600');
                    btn.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                } else if (btn.textContent === userAnswer) {
                    btn.classList.add('bg-red-600');
                    btn.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                }
            });

            if (isCorrect) {
                feedbackEl.textContent = 'Correct!';
                feedbackEl.classList.add('text-green-400');
            } else {
                feedbackEl.textContent = `Incorrect. The correct answer was: ${actualCorrectAnswer}`;
                feedbackEl.classList.add('text-red-400');
            }
            feedbackEl.classList.remove('hidden');

            // Save progress and update status bar
            saveProgress();
            updateStatusBar();

            // Auto-scroll to the next question, if not the last one
            if (questionIndex < quizQuestions.length - 1) {
                setTimeout(() => {
                    const nextQuestionCard = document.getElementById(`question-card-${questionIndex + 1}`);
                    if (nextQuestionCard) {
                        nextQuestionCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 500); // Wait for a moment before scrolling
            }
        }

        // Event Listeners
        insightsBtn.addEventListener('click', () => {
            mainSection.classList.add('hidden');
            quizSection.classList.add('hidden');
            quizStatusBar.classList.add('hidden');
            insightsSection.classList.remove('hidden');
            insightsBtn.classList.add('hidden');
            quizBtn.classList.remove('hidden');
            renderDashboard();
            populateMistakesSelector();
        });

        quizBtn.addEventListener('click', () => {
            insightsSection.classList.add('hidden');
            mainSection.classList.remove('hidden');
            quizBtn.classList.add('hidden');
            insightsBtn.classList.remove('hidden');
            renderQuizCards();
        });

        backBtn.addEventListener('click', () => {
            quizSection.classList.add('hidden');
            quizStatusBar.classList.add('hidden');
            insightsSection.classList.add('hidden');
            navbar.classList.remove('hidden');
            mainSection.classList.remove('hidden');
            insightsBtn.classList.remove('hidden');
            quizBtn.classList.add('hidden');
            renderQuizCards();
        });

        submitQuizBtn.addEventListener('click', () => {
            showQuizSummary();
        });

        startNewQuizBtn.addEventListener('click', () => {
            insightsSection.classList.add('hidden');
            mainSection.classList.remove('hidden');
            renderQuizCards();
        });

        closeSummaryModalBtn.addEventListener('click', () => {
            quizSummaryModal.classList.add('hidden');
        });

        resetQuizBtn.addEventListener('click', () => {
            localStorage.removeItem(currentQuizName + "_progress");
            localStorage.removeItem(currentQuizName + "_stats");
            quizSummaryModal.classList.add('hidden');
            startQuiz(currentQuizName, true);
        });

        reattemptWrongBtn.addEventListener('click', () => {
            reattemptModal.classList.remove('hidden');
            quizSummaryModal.classList.add('hidden');
        });

        confirmReattemptBtn.addEventListener('click', () => {
            reattemptModal.classList.add('hidden');
            const wrongAndUnattempted = quizQuestions.filter(q => q.userAnswer === null || !q.isCorrect);
            quizQuestions = wrongAndUnattempted;
            renderQuestions();
        });

        cancelReattemptBtn.addEventListener('click', () => {
            reattemptModal.classList.add('hidden');
            showQuizSummary(); // Go back to the summary modal
        });

        quitQuizBtnSummary.addEventListener('click', () => {
            quizSummaryModal.classList.add('hidden');
            quizSection.classList.add('hidden');
            quizStatusBar.classList.add('hidden');
            navbar.classList.remove('hidden');
            mainSection.classList.remove('hidden');
            renderQuizCards();
        });

        mistakesQuizSelector.addEventListener('change', (e) => {
            const quizName = e.target.value;
            displayMistakes(quizName);
        });

        mixQuizBtn.addEventListener('click', () => {
            openMixQuizModal();
        });

        cancelMixQuizBtn.addEventListener('click', () => {
            mixQuizModal.classList.add('hidden');
        });

        startMixQuizBtn.addEventListener('click', async () => {
            mixQuizModal.classList.add('hidden');
            loadingOverlay.style.display = 'flex';
            
            const selectedQuizzes = Array.from(quizList.querySelectorAll('input[type="checkbox"]:checked'));
            const allQuestions = [];
            
            if (selectedQuizzes.length === 0) {
                showMessageBox("Please select at least one quiz to mix.");
                loadingOverlay.style.display = 'none';
                return;
            }

            const questionsPerQuiz = Math.floor(100 / selectedQuizzes.length);
            let remainingQuestions = 100 % selectedQuizzes.length;
            
            for (const checkbox of selectedQuizzes) {
                const quizName = checkbox.dataset.name;
                const questions = allQuizzesData[quizName];

                if (questions) {
                    shuffleArray(questions);
                    let numToTake = questionsPerQuiz;
                    if (remainingQuestions > 0) {
                        numToTake++;
                        remainingQuestions--;
                    }
                    allQuestions.push(...questions.slice(0, numToTake));
                }
            }

            shuffleArray(allQuestions);

            loadingOverlay.style.display = 'none';

            currentQuizName = 'Mixed Quiz';
            quizQuestions = allQuestions;
            totalQuestions = quizQuestions.length;
            score = 0;
            mistakes = [];
            attemptedCount = 0;
            localStorage.removeItem(currentQuizName + "_progress");

            mainSection.classList.add('hidden');
            insightsSection.classList.add('hidden');
            navbar.classList.add('hidden');
            quizSection.classList.remove('hidden');
            quizStatusBar.classList.remove('hidden');
            
            renderQuestions();
            updateStatusBar();
            window.scrollTo(0, 0);
        });

        function openMixQuizModal() {
            quizList.innerHTML = '';
            quizzes.forEach(q => {
                const quizItem = document.createElement('div');
                quizItem.className = 'flex items-center gap-2 text-white';
                quizItem.innerHTML = `
                    <input type="checkbox" id="mix-${q.name}" data-name="${q.name}" class="form-checkbox text-indigo-600 bg-gray-600 border-gray-500 rounded focus:ring-indigo-500">
                    <label for="mix-${q.name}" class="text-sm font-medium">${q.name}</label>
                `;
                quizList.appendChild(quizItem);
            });
            mixQuizModal.classList.remove('hidden');
        }

        function showQuizSummary() {
            const unattemptedCount = totalQuestions - attemptedCount;
            const accuracy = attemptedCount ? Math.round((score / attemptedCount) * 100) : 0;
            const percentage = (score / totalQuestions) * 100;
            
            summaryScoreEl.textContent = `${score}/${totalQuestions}`;
            summaryCorrectEl.textContent = score;
            summaryIncorrectEl.textContent = mistakes.length;
            summaryUnattemptedEl.textContent = unattemptedCount;
            summaryAccuracyEl.textContent = `${accuracy}%`;
            
            // Animate progress circle
            const radius = summaryProgressCircle.r.baseVal.value;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percentage / 100) * circumference;
            summaryProgressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            summaryProgressCircle.style.strokeDashoffset = offset;

            quizSummaryModal.classList.remove('hidden');
        }

        function renderDashboard() {
            renderOverallStats();
            renderQuizBarChart();
        }
        
        function renderOverallStats() {
            let totalCorrect = 0;
            let totalAttempted = 0;
            let totalWrong = 0;

            const quizNames = quizzes.map(q => q.name);
            quizNames.push("Mixed Quiz");

            quizNames.forEach(name => {
                const stats = JSON.parse(localStorage.getItem(name + "_stats"));
                if (stats) {
                    totalCorrect += stats.correct;
                    totalAttempted += stats.attempted;
                    totalWrong += (stats.attempted - stats.correct);
                }
            });

            // Update overall accuracy
            const overallAccuracy = totalAttempted ? Math.round((totalCorrect / totalAttempted) * 100) : 0;
            overallAccuracySpan.textContent = `${overallAccuracy}%`;

            // Animate overall progress circle
            const radius = progressCircle.r.baseVal.value;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (overallAccuracy / 100) * circumference;
            progressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            progressCircle.style.strokeDashoffset = offset;

            // Update the new dashboard stats cards
            dashboardStats.innerHTML = `
                <div class="bg-gray-700 p-4 rounded-xl shadow-md flex flex-col items-center justify-center">
                    <i data-lucide="circle-help" class="h-6 w-6 text-indigo-400 mb-2"></i>
                    <p class="text-sm text-gray-400">Attempted</p>
                    <p class="text-xl font-bold">${totalAttempted}</p>
                </div>
                <div class="bg-gray-700 p-4 rounded-xl shadow-md flex flex-col items-center justify-center">
                    <i data-lucide="circle-check" class="h-6 w-6 text-green-400 mb-2"></i>
                    <p class="text-sm text-gray-400">Correct</p>
                    <p class="text-xl font-bold text-green-400">${totalCorrect}</p>
                </div>
                <div class="bg-gray-700 p-4 rounded-xl shadow-md flex flex-col items-center justify-center">
                    <i data-lucide="circle-x" class="h-6 w-6 text-red-400 mb-2"></i>
                    <p class="text-sm text-gray-400">Wrong</p>
                    <p class="text-xl font-bold text-red-400">${totalWrong}</p>
                </div>
            `;
            lucide.createIcons();
        }

        function renderQuizBarChart() {
            let hasData = false;
            quizBarChart.innerHTML = '';
            quizzes.forEach(q => {
                const stats = JSON.parse(localStorage.getItem(q.name + "_stats"));
                if (stats && stats.attempted > 0) {
                    hasData = true;
                    const accuracy = Math.round((stats.correct / stats.attempted) * 100);
                    const barContainer = document.createElement('div');
                    barContainer.className = 'flex flex-col items-center h-full justify-end';
                    barContainer.innerHTML = `
                        <div class="bar w-8 relative" style="height: ${accuracy}%;">
                            <span class="absolute -top-6 text-white text-xs font-bold w-full text-center">${accuracy}%</span>
                        </div>
                        <span class="mt-2 text-center w-12 truncate">${q.name}</span>
                    `;
                    quizBarChart.appendChild(barContainer);
                }
            });
            if (hasData) {
                chartMessage.classList.add('hidden');
            } else {
                chartMessage.classList.remove('hidden');
            }
        }

        function populateMistakesSelector() {
            mistakesQuizSelector.innerHTML = '<option value="">-- Select Quiz --</option>';
            const quizNames = quizzes.map(q => q.name);
            quizNames.forEach(name => {
                const progress = localStorage.getItem(name + "_progress");
                if (progress) {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    mistakesQuizSelector.appendChild(option);
                }
            });
        }

        function displayMistakes(quizName) {
            mistakesContainer.innerHTML = '';
            if (!quizName) {
                return;
            }
            const progress = JSON.parse(localStorage.getItem(quizName + "_progress"));
            if (progress && progress.mistakes) {
                if (progress.mistakes.length === 0) {
                    mistakesContainer.innerHTML = `<p class="text-gray-400 text-center">No mistakes found for this quiz.</p>`;
                } else {
                    progress.mistakes.forEach(mistake => {
                        const mistakeCard = document.createElement('div');
                        mistakeCard.className = "bg-gray-700 p-4 rounded-xl shadow-md space-y-2";
                        mistakeCard.innerHTML = `
                            <p class="font-bold">Question:</p>
                            <p class="text-sm text-gray-300">${mistake.question}</p>
                            <p class="font-bold text-red-400">Your Answer: <span class="text-red-300">${mistake.userAnswer}</span></p>
                            <p class="font-bold text-green-400">Correct Answer: <span class="text-green-300">${mistake.correctAnswer}</span></p>
                        `;
                        mistakesContainer.appendChild(mistakeCard);
                    });
                }
            } else {
                mistakesContainer.innerHTML = `<p class="text-gray-400 text-center">No mistakes found for this quiz.</p>`;
            }
        }
    </script>
</body>
</html>
